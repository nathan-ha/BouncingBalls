<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Bouncy Balls</title>
    <style>
        #container {
            position: relative;
            background: white;
            border-style: solid;
            border-color: black;
        }
        .block {
            display: block;
            width: 70.9%;
            border: none;
            background-color: rgb(240,240,240);
            font-size: 16px;
            cursor: pointer;
            text-align: center;
            border-style: solid;
            border-color: rgba(210,210,210,0.5);
        }
    </style>
    <script>
        var balls = [];
        var containerWidth = 1600; 
        var containerHeight = 800;
        var ballDiameter = 100;
        var numBalls = 20;

        function randomInt(min, max) {
            min = Math.ceil(min);
            max = Math.floor(max);
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }
        function randomFloat(min, max) {
            return Math.random() * (max - min) + min;
        }

        function createBalls(numBalls) {
            for (let i = 0; i < numBalls; i++) {
                let ballObj = {
                    id: "ball_" + i.toString(), //id of the div
                    x: randomInt(0, containerWidth - ballDiameter), //generates random coordinates on canvas
                    y: randomInt(0, containerHeight - ballDiameter),
                    xDirection: randomInt(0, 1), //1 for right, 0 for left
                    yDirection: randomInt(0, 1), //1 for down, 0 for up
                    xSpeed: randomFloat(0.5, 6),
                    ySpeed: randomFloat(0.5, 6)
                };

                balls.push(ballObj); //saves the object into a list

                let ball = document.createElement("div"); //creates new div
                ball.setAttribute("id", ballObj.id) //gives the div an id

                //style each element
                ball.style.position = "absolute";
                ball.style.width = ballDiameter + "px";
                ball.style.height = ballDiameter + "px";
                ball.style.top = ballObj.x + "px";
                ball.style.left = ballObj.y + "px";
                ball.style.borderRadius = "50%";
                ball.style.opacity = "80%";
                ball.style.background = "rgb(" + randomInt(0, 255).toString() + ", " 
                                               + randomInt(0, 255).toString() + ", "
                                               + randomInt(0, 255).toString() + ")";
            
                document.getElementById("container").appendChild(ball); //add the new element to the html doc inside of the container div
            }
        }

        function moveBall(ball) {

            if (ball.xDirection == 1) {
                ball.x += ball.xSpeed;
            }
            else {
                ball.x -= ball.xSpeed;
            }

            if (ball.yDirection == 1) {
                ball.y += ball.ySpeed;
            }
            else {
                ball.y -= ball.ySpeed;
            }
        }

        function detectedCollision(ball, ball_j) {
            let ballRadius = ballDiameter / 2;
            //center coordinates for balls
            let ball_center = {
                x: ball.x + ballRadius,
                y: ball.y + ballRadius
            }
            let ball_j_center = {
                x: ball_j.x + ballRadius,
                y: ball_j.y + ballRadius
            }

            let distanceBetweenCenters = Math.sqrt((ball_center.x - ball_j_center.x)**2 + (ball_center.y - ball_j_center.y)**2);

            return distanceBetweenCenters <= ballDiameter;
        }

        function handleCollisions(ball) {
            //check for collision with boundaries
            if (ball.x >= containerWidth - ballDiameter) {
                ball.x = containerWidth - ballDiameter;
                ball.xDirection = 0;
            }
            else if (ball.x <= 0) {
                ball.x = 0
                ball.xDirection = 1;
            }

            if (ball.y >= containerHeight - ballDiameter) {
                ball.y = containerHeight - ballDiameter;
                ball.yDirection = 0;
            }
            else if (ball.y <= 0) {
                ball.y = 0;
                ball.yDirection = 1;
            }

            //check for collisions with other balls
            for (let j = 0; j < balls.length; j++) {

                if ((ball.id != balls[j].id) && detectedCollision(ball, balls[j])) {
                    //reverses direction if  collision is detected
                    if (ball.xDirection == 1) {
                        ball.xDirection = 0;
                    }
                    else if (ball.xDirection == 0) {
                        ball.xDirection = 1;
                    }
                    if (ball.yDirection == 1) {
                        ball.yDirection = 0;
                    }
                    else if (ball.yDirection == 0) {
                        ball.yDirection = 1;
                    }

                    for (let k = 0; k < ballDiameter && detectedCollision(ball, balls[j]); k++) {
                        moveBall(ball);
                    }
                }
                
            } 
        }

        function frame() {
            for (let i = 0; i < balls.length; i++) {
                //draw balls
                document.getElementById(balls[i].id).style.left = balls[i].x + "px";
                document.getElementById(balls[i].id).style.top = balls[i].y + "px";

                handleCollisions(balls[i]);
                moveBall(balls[i]);
            }
            requestAnimationFrame(frame);
        }

        //not to be confused with frame -- this one deletes everything and recreates everything from scratch
        function refreshScreen() {
            //changes ball width
            let ballDiameterFromInput = Number(document.getElementById("ballDiameter").value);
            if (ballDiameterFromInput <= 1) {
                ballDiameter = 1;
            }
            else {
                ballDiameter = ballDiameterFromInput;
            }
            //gets number of balls
            let numBallsFromInput = Number(document.getElementById("number_of_balls").value);
            if (numBallsFromInput <= 0) {
                numBalls = 0;
            }
            else {
                numBalls = numBallsFromInput;
            }
            //changes container width and height
            let containerWidthFromInput = Number(document.getElementById("canvasWidth").value);
            if (containerWidthFromInput <= ballDiameter) {
                containerWidth = ballDiameter;
            }
            else {
                containerWidth = containerWidthFromInput;
            }
            let containerHeightFromInput = Number(document.getElementById("canvasHeight").value);
            if (containerHeightFromInput <= ballDiameter) {
                containerHeight = ballDiameter;
            }
            else {
                containerHeight = containerHeightFromInput;
            }

            //resize the canvas
            document.getElementById("container").style.width = containerWidth + "px";
            document.getElementById("container").style.height = containerHeight + "px";

            //refreshes text input values (mostly in case the value goes out of range)
            document.getElementById('number_of_balls').value = numBalls;
            document.getElementById('ballDiameter').value = ballDiameter;
            document.getElementById('canvasWidth').value = containerWidth;
            document.getElementById('canvasHeight').value = containerHeight;

            //delete all old divs
            for (let i = 0; i < balls.length; i++) {
                document.getElementById(balls[i].id).remove();
            }
            //clear the ball list and make new ones
            balls = [];
            createBalls(numBalls);
        }

    </script>
  </head>
  <body>
    <main>
        <form id="inputs">
            <label for="number_of_balls">Number of Balls:</label>
            <input type="text" id="number_of_balls">
    
            <label for="ballDiameter">Ball Diameter (px):</label>
            <input type="text" id="ballDiameter">
    
            <label for="canvasWidth">Canvas Width (px):</label>
            <input type="text" id="canvasWidth">
            <label for="canvasHeight">Canvas Height (px):</label>
            <input type="text" id="canvasHeight">  

            <button type="text" id="refresh" class="block" onclick="refreshScreen()">Refresh</button>
        </form>  
        
        <div id="container"></div>
        <script>
            console.log("program started " + (new Date()).getTime());
            //TODO: implement resizing the canvas by dragging mouse
            document.getElementById("container").style.width = containerWidth + "px";
            document.getElementById("container").style.height = containerHeight + "px";
            createBalls(numBalls);
            requestAnimationFrame(frame);
        </script>
    </main>
    
    <script>
        //adds default values to the text box
        document.getElementById('number_of_balls').value = numBalls;
        document.getElementById('ballDiameter').value = ballDiameter;
        document.getElementById('canvasWidth').value = containerWidth;
        document.getElementById('canvasHeight').value = containerHeight;
    </script>

  </body>
</html>
